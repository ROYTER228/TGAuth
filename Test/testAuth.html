<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>Тест авторизации через Telegram</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }

    .block {
      margin-bottom: 30px;
    }

    button {
      margin-right: 10px;
    }

    #log {
      background: #f5f5f5;
      padding: 10px;
      min-height: 60px;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>
  <h1>Тест авторизации через Telegram</h1>

  <div class="block">
    <h2>DeeplinkAuth</h2>
    <button id="genDeeplink">Сгенерировать Deeplink</button>
    <div>Deeplink: <span id="deeplink"></span></div>
  </div>

  <div class="block">
    <h2>CodeAuth</h2>
    <button id="genCode">Сгенерировать код</button>
    <div>Код: <span id="code"></span></div>
  </div>

  <div class="block">
    <h2>WidgetAuth</h2>
    <input id="widgetData" placeholder="Вставьте данные виджета (JSON)" style="width:300px;">
    <button id="widgetAuthBtn">Проверить виджет</button>
  </div>

  <div class="block">
    <h2>TwoFAAuth</h2>
    <input id="twofaUserId" placeholder="User ID" type="number">
    <button id="twofaBtn">Старт 2FA</button>
  </div>

  <div class="block">
    <h2>Лог</h2>
    <div id="log"></div>
  </div>

  <script type="module">
    import {
      DeeplinkAuth,
      CodeAuth,
      WidgetAuth,
      TwoFAAuth
    } from '../Src/index.js'

    const botToken = '7935582771:AAGsPyE5K6l6AUD2_blvWaVgSBSJ748fBio'

    // DeeplinkAuth
    const deeplinkAuth = new DeeplinkAuth({
      botToken,
      transport: ['callback'],
      onAuth: (user) => log('DeeplinkAuth (callback): ' + JSON.stringify(user)),
    })
    document.getElementById('genDeeplink').onclick = () => {
      const link = deeplinkAuth.generateDeeplink()
      document.getElementById('deeplink').textContent = link
      log('Deeplink сгенерирован: ' + link)
    }

    // CodeAuth
    const codeAuth = new CodeAuth({
      botToken,
      transport: ['callback'],
      onAuth: (user) => log('CodeAuth (callback): ' + JSON.stringify(user)),
    })
    document.getElementById('genCode').onclick = () => {
      const code = codeAuth.generateCode()
      document.getElementById('code').textContent = code
      log('Код сгенерирован: ' + code)
    }

    // WidgetAuth
    const widgetAuth = new WidgetAuth({
      botToken,
      transport: ['callback'],
      onAuth: (user) => log('WidgetAuth (callback): ' + JSON.stringify(user)),
    })
    document.getElementById('widgetAuthBtn').onclick = () => {
      try {
        const data = JSON.parse(document.getElementById('widgetData').value)
        widgetAuth.handleAuth(data)
        log('WidgetAuth: handleAuth вызван')
      } catch (e) {
        log('Ошибка парсинга JSON для WidgetAuth')
      }
    }

    // TwoFAAuth
    const twoFAAuth = new TwoFAAuth({
      botToken,
      transport: ['callback'],
      onAuth: (user) => log('TwoFAAuth (callback): ' + JSON.stringify(user)),
    })
    document.getElementById('twofaBtn').onclick = () => {
      const userId = document.getElementById('twofaUserId').value
      twoFAAuth.start2FA && twoFAAuth.start2FA(userId)
      log('TwoFAAuth: start2FA вызван для userId ' + userId)
    }

    function log(msg) {
      const logDiv = document.getElementById('log')
      logDiv.textContent += msg + '\n'
      logDiv.scrollTop = logDiv.scrollHeight
    }
  </script>
</body>

</html>